<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Five Nights At Capybara</title>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: #000; color: white; font-family: 'Courier New', monospace; overflow: hidden; height: 100vh; }
        
        /* MENU */
        #main-menu { position: fixed; inset: 0; z-index: 1000; background: #000; display: flex; flex-direction: column; justify-content: center; padding-left: 10%; }
        #menu-bg { position: absolute; right: 0; height: 100%; z-index: -1; filter: brightness(0.4); }
        .menu-title { font-size: 45px; color: #fff; margin: 0; text-shadow: 2px 2px #f00; line-height: 0.9; }
        .menu-btn { background: none; border: none; color: #fff; font-size: 24px; text-align: left; padding: 10px 0; cursor: pointer; display: block; outline: none; }
        .menu-btn:hover { color: #f00; }

        /* EFECTO ESTÁTICA */
        .static { position: absolute; inset: 0; background: url('https://upload.wikimedia.org/wikipedia/commons/b/b1/White_noise_on_a_television_screen.gif'); opacity: 0.08; pointer-events: none; z-index: 1001; }

        /* JUEGO UI */
        #hud { height: 10%; padding: 10px; display: flex; justify-content: space-between; align-items: center; background: #050505; border-bottom: 2px solid #333; }
        #screen { height: 50%; position: relative; background: #000; display: flex; justify-content: center; align-items: flex-end; overflow: hidden; }
        
        .anim { position: absolute; height: 90%; width: auto; display: none; bottom: 0; z-index: 10; filter: brightness(0); }
        .light-on { filter: brightness(1.2) !important; }
        .blink { animation: blink-anim 0.2s infinite; }
        @keyframes blink-anim { 0%, 45% { opacity: 1; } 50%, 95% { opacity: 0; } }

        /* GOLDEN CAPYBARA EN LA OFICINA */
        #golden { z-index: 20; height: 75%; filter: brightness(0.8); bottom: 5%; position: absolute; display: none; }

        #controls { height: 40%; display: grid; grid-template-columns: 1fr 1fr; gap: 5px; padding: 10px; background: #0a0a0a; }
        .btn { background: #1a1a1a; border: 2px solid #444; color: #fff; display: flex; align-items: center; justify-content: center; border-radius: 8px; font-weight: bold; }
        .active { background: #800 !important; border-color: red; }

        /* PANTALLAS FINALES */
        #victory { position: fixed; inset: 0; background: #000; z-index: 2000; display: none; align-items: center; justify-content: center; font-size: 60px; }
        #jumpscare-ui { position: fixed; inset: 0; z-index: 3000; display: none; background: #000; justify-content: center; align-items: center; }
        #scare-img { height: 130%; animation: shake 0.05s infinite; }
        @keyframes shake { 0%{transform:translate(8px,8px);} 50%{transform:translate(-8px,-8px);} 100%{transform:translate(8px,8px);} }
    </style>
</head>
<body>

    <audio id="s_music" src="https://files.catbox.moe/4vwdme" preload="auto"></audio>
    <div class="static"></div>

    <div id="main-menu">
        <img id="menu-bg" class="blink" src="https://http2.mlstatic.com/D_NQ_NP_698983-MLV83096028544_032025-O.webp">
        <h1 class="menu-title">Five<br>Nights<br>At<br>Capybara</h1>
        <br>
        <button class="menu-btn" onclick="start()">New Game</button>
        <button class="menu-btn" onclick="start()">Night 1</button>
    </div>

    <div id="victory">5 AM</div>

    <div id="jumpscare-ui">
        <img id="scare-img" src="">
        <img id="job-card" style="position:absolute; width:260px; display:none; border:6px solid white; transform: rotate(-8deg); bottom: 15%;" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRZIjch8ag3LfMixmJZdl7dArIXhXlZqjHwSFrzbgb6g3mxwHMUdvylykc&s">
    </div>

    <div id="hud">
        <div>BAT: <span id="p-val">100</span>%</div>
        <div id="t-val" style="color:red">12 AM</div>
    </div>

    <div id="screen">
        <img id="capybara-img" class="anim" src="https://http2.mlstatic.com/D_NQ_NP_698983-MLV83096028544_032025-O.webp">
        <img id="bonnie-img" class="anim" src="https://i.ibb.co/W7GG9PF/IMG-20251218-130013.png">
        <img id="chica-img" class="anim" src="https://i.ibb.co/gFRcJwp7/IMG-20251218-130121.png">
        <img id="golden" src="https://i.ibb.co/v6WfvcY8/golden-capy.png">
    </div>

    <div id="controls">
        <div class="btn" onclick="setCam(1)">CAM 1</div>
        <div class="btn" onclick="setCam(2)">CAM 2</div>
        <div class="btn" onclick="setCam(3)">CAM 3</div>
        <div class="btn" id="l-btn" onclick="toggleLight()">LIGHT</div>
        <div class="btn" id="d-btn" style="grid-column: span 2;" onclick="toggleDoor()">CLOSE DOOR</div>
    </div>

    <script>
        let pow = 100, hour = 0, cam = 1, door = false, light = false, run = false;
        let pos = { a: 1, b: 1, c: 1 };
        let goldenActive = false;
        const snd = document.getElementById('s_music');

        function start() {
            document.getElementById('main-menu').style.display = 'none';
            run = true;
            gameLoop();
        }

        function toggleDoor() { door = !door; document.getElementById('d-btn').classList.toggle('active', door); }
        function toggleLight() { light = !light; document.getElementById('l-btn').classList.toggle('active', light); update(); }
        
        function setCam(n) { 
            cam = n; 
            // PROBABILIDAD DE GOLDEN (2%) cada vez que cambias cámara
            if(!goldenActive && Math.random() < 0.02) {
                goldenActive = true;
                document.getElementById('golden').style.display = 'block';
                // Si no haces nada en 3 segundos... ¡SUSTO!
                setTimeout(() => {
                    if(goldenActive) triggerScare('golden', false);
                }, 3000);
            }
            update(); 
        }

        function update() {
            if(!run) return;
            const c = document.getElementById('capybara-img'), b = document.getElementById('bonnie-img'), ch = document.getElementById('chica-img');
            c.style.display = (pos.a === cam) ? "block" : "none";
            b.style.display = (pos.b === cam) ? "block" : "none";
            ch.style.display = (pos.c === cam) ? "block" : "none";
            
            let lit = (cam !== 3 || light);
            [c, b, ch].forEach(i => lit ? i.classList.add('light-on') : i.classList.remove('light-on'));
        }

        function gameLoop() {
            if(!run) return;
            pow -= (0.15 + (door?0.5:0));
            document.getElementById('p-val').innerText = Math.max(0, Math.floor(pow));
            if(pow <= 0) triggerScare('capybara', false);

            setTimeout(() => {
                hour++;
                if(hour === 6) { win(); return; }
                document.getElementById('t-val').innerText = hour + " AM";
                gameLoop();
            }, 20000); // 20 seg por hora

            // IA de los animatrónicos
            if(Math.random() > 0.8) pos.a = Math.min(3, pos.a + 1);
            if(Math.random() > 0.7) pos.b = Math.min(3, pos.b + 1);
            if(pos.a === 3 && !door) triggerScare('capybara', false);
            if(pos.b === 3 && !door) triggerScare('bonnie', true);
            update();
        }

        function win() {
            run = false;
            const v = document.getElementById('victory');
            v.style.display = 'flex';
            setTimeout(() => { v.innerText = "6 AM"; v.style.color = "#0f0"; }, 2000);
            setTimeout(() => location.reload(), 7000);
        }

        function triggerScare(char, card) {
            if(!run && char !== 'golden') return;
            run = false;
            snd.play();
            
            const scareUI = document.getElementById('jumpscare-ui');
            const scareImg = document.getElementById('scare-img');
            
            // Si es Golden, pantalla amarilla
            if(char === 'golden') {
                scareUI.style.backgroundColor = "rgba(255, 255, 0, 0.5)";
                scareImg.src = "https://i.ibb.co/v6WfvcY8/golden-capy.png";
            } else {
                scareImg.src = document.getElementById(char+'-img').src;
                if(card) document.getElementById('job-card').style.display = 'block';
            }

            scareUI.style.display = 'flex';
            setTimeout(() => location.reload(), 4000);
        }
    </script>
</body>
</html>
